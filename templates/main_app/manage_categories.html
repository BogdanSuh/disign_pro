<!-- templates/main_app/manage_categories.html -->
{% extends "base.html" %}

{% block title %}Категории проектов — Design.pro{% endblock %}

{% block content %}
    <div class="container admin-section">
        <div class="section-header">
            <h1> Категории проектов</h1>
            <p class="subtitle">
                Категории помогают распределять заявки: от бытовых консультаций до комплексных реноваций.
                Вы можете добавлять новые или удалять устаревшие — главное, чтобы команда и клиенты понимали, о чём
                речь.
            </p>
        </div>

        <!-- Добавление категории -->
        <div class="panel">
            <h2> Создать новую категорию</h2>
            <form method="post" class="add-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                <div class="input-group">
                    <label for="category-name">Название категории</label>
                    <input
                            type="text"
                            id="category-name"
                            name="name"
                            required
                            placeholder="Напр.: Авторский надзор, Лофт-офисы, Бюджетный ремонт"
                            maxlength="100"
                    >
                </div>
                <button type="submit" class="btn btn-success">Добавить категорию</button>
            </form>
        </div>

        <!-- Список категорий -->
        <div class="panel">
            <h2> Текущие категории ({{ categories|length }})</h2>

            {% if categories %}
                <ul class="category-list">
                    {% for category in categories %}
                        <li class="category-item">
                        <span class="category-name">
                            <strong>{{ category.name }}</strong>
                            <small class="category-id">#{{ category.id }}</small>
                        </span>
                            <form
                                    method="post"
                                    class="delete-action"
                                    onsubmit="return confirmDelete('{{ category.name|escapejs }}');"
                            >
                                {% csrf_token %}
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="category_id" value="{{ category.id }}">
                                <button type="submit" class="btn btn-light btn-delete">
                                     Удалить
                                </button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="empty-box">
                    <p>Пока нет ни одной категории.</p>
                    <p class="hint">Создайте первую — например, «Жилые интерьеры» или «Коммерческие пространства».</p>
                </div>
            {% endif %}
        </div>

        <div class="actions-footer">
            <a href="{% url 'admin_dashboard' %}" class="btn btn-outline"> Вернуться в панель управления</a>
        </div>
    </div>

    <!-- Безопасное подтверждение удаления -->
    <script>
        function confirmDelete(name) {
            return confirm(
                `Вы действительно хотите удалить категорию?\n\n«${name}»\n\n❗ Все связанные заявки будут удалены без возможности восстановления.`
            );
        }
    </script>
{% endblock %}